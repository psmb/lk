define(["jquery"],function(a){var b={deleteElements:function(c,d,e){var f,g;if(e){var h=d[0];f=d[1],g=h+"_"+f}else f=d[0],g=f;var i,j=g+"count",k=parseInt(a('[name="'+j+'"]').val());for(var l in c)if(c[l].name==f){i=c[l];break}if(1==k){var m="id_"+g+"_0";return void b.removeInputFromNode(i,m)}var n=k-1;a("#id_"+g+" br").last().remove();for(l in i.values){var o=i.values[l],p="fitem_id_"+g+"_"+n+"_"+o.name;if(a("#"+p).remove(),"numeric-array"===o.type){var q=g+"_"+n+"_"+o.name+"count",r=parseInt(a("[name='"+q+"']").val());r>=2&&a("#id_"+g+" br").slice(-(r-1)).remove();for(var s in o.values)for(var t=o.values[s],u=0;u<r;u++){var v=p+"_"+u+"_"+t.name;a("#"+v).remove()}var w="fitem_id_addmore_"+g+"_"+n+"_"+o.name;a("#"+w).remove(),a("[name='"+q+"']").remove()}}a('[name="'+j+'"]').val(k-1)},addMoreRootElements:function(c,d,e){var f,g,h;if(e){var i=d[0];f=d[1],g=i+"["+f+"]",h=i+"_"+f}else f=d[0],g=f,h=f;var j,k=h+"count",l=parseInt(a('[name="'+k+'"]').val());for(var m in c)if(c[m].name==f){j=c[m];break}var n,o=l-1,p="<br/>";for(m in j.values){var q=j.values[m],r=g+"["+l+"]["+q.name+"]",s="id_"+h+"_"+l+"_"+q.name,t=g+"["+o+"]["+q.name+"]",u="id_"+h+"_"+o+"_"+q.name;if("numeric-array"==q.type){var v=a("#fitem_"+u).attr("class");p+='<div id="fitem_'+s+'" class="'+v+'">',p+=a("#fitem_"+u).html(),p+="</div>";for(var w in q.values){var x=q.values[w],y=r+"[0]["+x.name+"]",z=s+"_0_"+x.name,A=t+"[0]["+x.name+"]",B=u+"_0_"+x.name,C=o+".0",D=l+".0";p+=b.copyElement(A,B,y,z,C,D)}var E="id_addmore_"+h+"_"+l+"_"+q.name,F="addmore_"+g+"["+l+"]["+q.name+"]",G="id_addmore_"+h+"_"+o+"_"+q.name,H="addmore_"+g+"["+o+"]["+q.name+"]";p+=b.copyElement(H,G,F,E,null,null);var I=h+"_"+o+"_"+q.name+"count",J=h+"_"+l+"_"+q.name+"count",K='<input name="'+J+'" value="1" type="hidden"></input>';a('[name="'+I+'"]').after(K)}else p+=b.copyElement(t,u,r,s,o,l)}a("#fgroup_id_buttons_"+h).before(p),n="id_"+h+"_"+l,b.removeInputFromNode(j,n),a('[name="'+k+'"]').val(l+1)},addMoreNestedElements:function(c,d,e,f){var g,h,i,j,k;f?(e?(g=d[0]+"["+d[1]+"]["+d[2]+"]",h=d[0]+"_"+d[1]+"_"+d[2],i=d[1],j=d[2]):(g=d[0]+"["+d[1]+"]",h=d[0]+"_"+d[1],i=d[0],j=d[1]),k=null):e?(g=d[0]+"["+d[1]+"]["+d[2]+"]",g=g+"["+d[3]+"]",h=d[0]+"_"+d[1]+"_"+d[2]+"_"+d[3],i=d[1],j=d[3],k=d[2]):(g=d[0]+"["+d[1]+"]["+d[2]+"]",h=d[0]+"_"+d[1]+"_"+d[2],i=d[0],j=d[2],k=d[1]);var l,m=h+"count",n=parseInt(a('[name="'+m+'"]').val());for(var o in c)if(c[o].name==i)for(var p in c[o].values)if(c[o].values[p].name==j){l=c[o].values[p];break}var q=n-1,r="<br/>";for(o in l.values){var s,t,u=l.values[o],v=g+"["+n+"]["+u.name+"]",w="id_"+h+"_"+n+"_"+u.name,x=g+"["+q+"]["+u.name+"]",y="id_"+h+"_"+q+"_"+u.name;null===k?(s=q,t=n):(s=k+"."+q,t=k+"."+n),r+=b.copyElement(x,y,v,w,s,t)}a("#fitem_id_addmore_"+h).before(r);var z="id_"+h+"_"+n;b.removeInputFromNode(l,z),a('[name="'+m+'"]').val(n+1)},removeInputFromNode:function(c,d){for(var e in c.values){var f=c.values[e],g=d+"_"+f.name;if("text"!=f.type&&"int"!=f.type||a("#"+g).val(""),"multiple-options"==f.type||"boolean"==f.type){var h="required"in f&&f.required===!0;h||a("#"+g+' option[value="undefined"]').prop("selected",!0).change()}if("numeric-array"==f.type)for(var i=g.replace("id_","")+"count",j=parseInt(a('[name="'+i+'"]').val()),k=0;k<j;k++){var l=g+"_"+k;b.removeInputFromNode(f,l)}}},copyElement:function(b,c,d,e,f,g){for(var h=a("#fitem_"+c).attr("class"),i=a("#fitem_"+c).html();i.indexOf(c)!=-1;)i=i.replace(c,e);for(;i.indexOf(b)!=-1;)i=i.replace(b,d);null!==f&&(f+=". ",g+=". ",i=i.replace('label for="'+e+'">'+f,'label for="'+e+'">'+g));var j='<div id="fitem_'+e+'" class="'+h+'">';return j+=i,j+="</div>"},addMore:function(){a(document).ready(function(){a(".mform").on("click",":button",function(c){var d=c.target.name;if(d.indexOf("addmore_")!==-1||d.indexOf("delete_")!==-1){var e,f,g=a.parseJSON(a('[name="templatevars"]').val()),h=a('[name="componenttype1"]').val(),i=h+"_features";d.indexOf("addmore_")!==-1?(e=!0,f=d.replace("addmore_","")):(f=d.replace("delete_",""),e=!1);var j=f.split(/\]\[|\[|\]/gi);0===j[j.length-1].length&&j.pop();var k;k=j[0]===i;var l=!1;for(var m in j)if(a.isNumeric(j[m])){l=!0;break}var n=!1;l||(k&&3===j.length&&(l=!0,n=!0),k||2!==j.length||(l=!0,n=!0)),e?l?b.addMoreNestedElements(g,j,k,n):b.addMoreRootElements(g,j,k):b.deleteElements(g,j,k)}})})}};return b});